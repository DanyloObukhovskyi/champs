<div class="stream" id="stream" style="display: none">
    <div class="title">
        LIVE
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none"
             id="closeFrame">
            <path d="M8.88392 8.00004L15.8169 1.06698C16.061 0.822882 16.061 0.427133 15.8169 0.18307C15.5728 -0.0609922 15.1771 -0.0610234 14.933 0.18307L7.99998 7.11613L1.06697 0.18307C0.82288 -0.0610234 0.427132 -0.0610234 0.18307 0.18307C-0.060992 0.427164 -0.0610233 0.822914 0.18307 1.06698L7.11608 8L0.18307 14.9331C-0.0610233 15.1772 -0.0610233 15.5729 0.18307 15.817C0.305101 15.939 0.465069 16 0.625037 16C0.785005 16 0.944943 15.939 1.067 15.817L7.99998 8.88394L14.933 15.817C15.055 15.939 15.215 16 15.375 16C15.5349 16 15.6949 15.939 15.8169 15.817C16.061 15.5729 16.061 15.1771 15.8169 14.9331L8.88392 8.00004Z"
                  fill="#86888A"/>
        </svg>
    </div>
    <div class="player">
        <div id="playerYT" class="playerWin" style="display: none"></div>
        <div id="playerTW" class="playerWin" style="display: none"></div>
        <div class="buttons">
            <div class="button" id="streamPopupSound">
                <span></span>
                <div id="playerButtonUnMuted">
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"
                         id="Capa_1" x="0px" y="0px" viewBox="0 0 448.075 448.075"
                         style="enable-background:new 0 0 448.075 448.075;" xml:space="preserve">
                            <path d="M352.021,16.075c0-6.08-3.52-11.84-8.96-14.4c-5.76-2.88-12.16-1.92-16.96,1.92l-141.76,112.96l167.68,167.68V16.075z"/>
                        <path d="M443.349,420.747l-416-416c-6.24-6.24-16.384-6.24-22.624,0s-6.24,16.384,0,22.624l100.672,100.704h-9.376  c-9.92,0-18.56,4.48-24.32,11.52c-4.8,5.44-7.68,12.8-7.68,20.48v128c0,17.6,14.4,32,32,32h74.24l155.84,124.48  c2.88,2.24,6.4,3.52,9.92,3.52c2.24,0,4.8-0.64,7.04-1.6c5.44-2.56,8.96-8.32,8.96-14.4v-57.376l68.672,68.672  c3.136,3.136,7.232,4.704,11.328,4.704s8.192-1.568,11.328-4.672C449.589,437.131,449.589,427.019,443.349,420.747z"/>
                        </svg>
                </div>
                <div id="playerButtonMuted" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1" x="0px" y="0px" viewBox="0 0 480 480" style="enable-background:new 0 0 480 480;" xml:space="preserve">
                        <path d="M278.944,17.577c-5.568-2.656-12.128-1.952-16.928,1.92L106.368,144.009H32c-17.632,0-32,14.368-32,32v128  c0,17.664,14.368,32,32,32h74.368l155.616,124.512c2.912,2.304,6.464,3.488,10.016,3.488c2.368,0,4.736-0.544,6.944-1.6  c5.536-2.656,9.056-8.256,9.056-14.4v-416C288,25.865,284.48,20.265,278.944,17.577z"/>
                        <path d="M368.992,126.857c-6.304-6.208-16.416-6.112-22.624,0.128c-6.208,6.304-6.144,16.416,0.128,22.656  C370.688,173.513,384,205.609,384,240.009s-13.312,66.496-37.504,90.368c-6.272,6.176-6.336,16.32-0.128,22.624  c3.136,3.168,7.264,4.736,11.36,4.736c4.064,0,8.128-1.536,11.264-4.64C399.328,323.241,416,283.049,416,240.009  S399.328,156.777,368.992,126.857z"/>
                        <path d="M414.144,81.769c-6.304-6.24-16.416-6.176-22.656,0.096c-6.208,6.272-6.144,16.416,0.096,22.624  C427.968,140.553,448,188.681,448,240.009s-20.032,99.424-56.416,135.488c-6.24,6.24-6.304,16.384-0.096,22.656  c3.168,3.136,7.264,4.704,11.36,4.704c4.064,0,8.16-1.536,11.296-4.64C456.64,356.137,480,299.945,480,240.009  S456.64,123.881,414.144,81.769z"/>
                        </svg>
                </div>
            </div>
            <div class="button" id="streamPopupStart">
                <span></span>
                <div id="playerButtonPlay">
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"
                         id="Capa_1" x="0px" y="0px" viewBox="0 0 480 480"
                         style="enable-background:new 0 0 480 480;" xml:space="preserve">
                            <path d="M278.944,17.577c-5.568-2.656-12.128-1.952-16.928,1.92L106.368,144.009H32c-17.632,0-32,14.368-32,32v128  c0,17.664,14.368,32,32,32h74.368l155.616,124.512c2.912,2.304,6.464,3.488,10.016,3.488c2.368,0,4.736-0.544,6.944-1.6  c5.536-2.656,9.056-8.256,9.056-14.4v-416C288,25.865,284.48,20.265,278.944,17.577z"/>
                        <path d="M368.992,126.857c-6.304-6.208-16.416-6.112-22.624,0.128c-6.208,6.304-6.144,16.416,0.128,22.656  C370.688,173.513,384,205.609,384,240.009s-13.312,66.496-37.504,90.368c-6.272,6.176-6.336,16.32-0.128,22.624  c3.136,3.168,7.264,4.736,11.36,4.736c4.064,0,8.128-1.536,11.264-4.64C399.328,323.241,416,283.049,416,240.009  S399.328,156.777,368.992,126.857z"/>
                        <path d="M414.144,81.769c-6.304-6.24-16.416-6.176-22.656,0.096c-6.208,6.272-6.144,16.416,0.096,22.624  C427.968,140.553,448,188.681,448,240.009s-20.032,99.424-56.416,135.488c-6.24,6.24-6.304,16.384-0.096,22.656  c3.168,3.136,7.264,4.704,11.36,4.704c4.064,0,8.16-1.536,11.296-4.64C456.64,356.137,480,299.945,480,240.009  S456.64,123.881,414.144,81.769z"/>
                        </svg>
                </div>
                <div id="playerButtonPause" style="display: none;">
                    <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 477.867 477.867" style="enable-background:new 0 0 477.867 477.867;" xml:space="preserve">
                        <path d="M187.733,0H51.2c-9.426,0-17.067,7.641-17.067,17.067V460.8c0,9.426,7.641,17.067,17.067,17.067h136.533 c9.426,0,17.067-7.641,17.067-17.067V17.067C204.8,7.641,197.159,0,187.733,0z"/>
                        <path d="M426.667,0H290.133c-9.426,0-17.067,7.641-17.067,17.067V460.8c0,9.426,7.641,17.067,17.067,17.067h136.533 c9.426,0,17.067-7.641,17.067-17.067V17.067C443.733,7.641,436.092,0,426.667,0z"/>
                        </svg>
                </div>
            </div>
            <div class="button" id="streamPopupLink">
                <span></span>
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"
                         id="Capa_1" x="0px" y="0px" viewBox="0 0 480 480"
                         style="enable-background:new 0 0 480 480;" xml:space="preserve">
                            <path d="M0,176h48V48h128V0H0V176z M16,16h144v16H32v128H16V16z"/>
                        <path d="M304,0v48h128v128h48V0H304z M464,160h-16V32H320V16h144V160z"/>
                        <path d="M48,304H0v176h176v-48H48V304z M160,448v16H16V320h16v128H160z"/>
                        <path d="M432,432H304v48h176V304h-48V432z M448,320h16v144H320v-16h128V320z"/>
                        </svg>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://player.twitch.tv/js/embed/v1.js"></script>
<script src="https://www.youtube.com/iframe_api"></script>
<script type="text/javascript">
    {% set video = setting.get('main_video') %}
    let mute = false;
    let play = false;
    let playerYT = null;
    let links = "{{ video is not null ? video.videoId : null }}";
    let videoTypeID = "{{ video.videoType['video_type'] ?? null }}";

    let full = false;
    //temporary fix, rewrite this part for add videos
    // let playerTW = new Object();
    // playerTW.pause= function (){}

    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
    }

    function hidePlayerButtons () {
        if (window.innerWidth <= 600 && full && play) {
            setTimeout(() => {
                document.getElementById('streamPopupSound').style.display = 'none';
                document.getElementById('streamPopupStart').style.display = 'none';
                document.getElementById('streamPopupLink').style.display = 'none';
            }, 1000)
        }
    }

    (function() {
        if(videoTypeID === '1'){
            var options = {
                scrolling: 'no',
                allowfullscreen: "true",
                width: '100%',
                height: '100%',
                channel: links,
                controls: false,
                muted: false,
                autoplay: true,
                // only needed if your site is also embedded on embed.example.com and othersite.example.com
                parent: ["test.champs.pro"]
            };
            playerTW = new Twitch.Player('playerTW', options);
            playerTW.addEventListener(Twitch.Player.READY, () => {
              console.log('playerTW.getMuted() ', playerTW.getMuted())
                document.getElementById('stream').style.display = 'flex';
                document.getElementById('playerTW').style.display = 'block';


                if (links === null) {
                    document.getElementById('streamPopupStart').querySelector('div').innerHTML = '<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 320.001 320.001" style="enable-background:new 0 0 320.001 320.001;" xml:space="preserve">' +
                    '<path d="M295.84,146.049l-256-144c-4.96-2.784-11.008-2.72-15.904,0.128C19.008,5.057,16,10.305,16,16.001v288 c0,5.696,3.008,10.944,7.936,13.824c2.496,1.44,5.28,2.176,8.064,2.176c2.688,0,5.408-0.672,7.84-2.048l256-144 c5.024-2.848,8.16-8.16,8.16-13.952S300.864,148.897,295.84,146.049z"/>' +
                    '</svg>';
                } else {
                    document.getElementById('streamPopupStart').querySelector('div').innerHTML = '<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 320.001 320.001" style="enable-background:new 0 0 320.001 320.001;" xml:space="preserve">' +
                    '<path d="M295.84,146.049l-256-144c-4.96-2.784-11.008-2.72-15.904,0.128C19.008,5.057,16,10.305,16,16.001v288 c0,5.696,3.008,10.944,7.936,13.824c2.496,1.44,5.28,2.176,8.064,2.176c2.688,0,5.408-0.672,7.84-2.048l256-144 c5.024-2.848,8.16-8.16,8.16-13.952S300.864,148.897,295.84,146.049z"/>' +
                    '</svg>';
                }

                playerTW.setMuted(false);
                playerTW.setVolume(0.5);

                document.querySelector('#closeFrame').addEventListener('click', function () {
                    const now = new Date();
                    now.setMinutes(now.getMinutes() + 10);

                    document.cookie = 'hide_popup_video=true;expires=' + now.toUTCString() + ';path=/';
                    playerTW.pause();
                    document.getElementById('stream').style.display = 'none';
                    document.getElementById('playerTW').style.display = 'none';
                })

                document.getElementById('streamPopupSound').querySelector('span').addEventListener('click', (e) => {
                    if (mute) {
                        mute = false;
                        document.getElementById('playerButtonUnMuted').style.display = 'flex';
                        document.getElementById('playerButtonMuted').style.display = 'none';
                    } else {
                        mute = true;
                        document.getElementById('playerButtonUnMuted').style.display = 'none';
                        document.getElementById('playerButtonMuted').style.display = 'flex';
                    }
                    playerTW.setMuted(mute);
                    hidePlayerButtons();
                    console.log('playerTW.getMuted() ', playerTW.getMuted())
                })

                document.getElementById('streamPopupStart').querySelector('span').addEventListener('click', (e) => {
                    if (play) {
                        playerTW.pause();
                        play = false;
                        document.getElementById('playerButtonPlay').style.display = 'flex';
                        document.getElementById('playerButtonPause').style.display = 'none';
                    } else {
                        playerTW.play();
                        play = true;
                        document.getElementById('playerButtonPlay').style.display = 'none';
                        document.getElementById('playerButtonPause').style.display = 'flex';
                    }
                    hidePlayerButtons();
                })

                document.getElementById('streamPopupLink').querySelector('span').addEventListener('click', (e) => {
                    if (window.innerWidth > 600) {
                        if (links !== null) {
                            window.open('https://www.twitch.tv/' + links, "_blank");
                        }
                    } else {
                        if (!full) {
                            full = true;
                            document.getElementById('stream').classList.add('full');
                        } else {
                            full = false;
                            document.getElementById('stream').classList.remove('full');
                        }
                    }
                    hidePlayerButtons();
                });
            });
        }
    })();

    function onYouTubeIframeAPIReady() {
      console.trace();
        if (getCookie('hide_popup_video') !== undefined) {
            return;
        }

        if(videoTypeID !== '1'){
            playerYT = new YT.Player('playerYT', {
                videoId: links,
                playerVars: {
                    'controls': 0,
                    'disablekb': 1,
                    'showinfo': 0,
                    'rel': 0,
                    'autoplay': 1,
                    'enablejsapi': 1,
                    'origin': 'http://champs.pro',
                },
                events: {
                    'onReady': (event) => {
                        document.getElementById('stream').style.display = 'flex';
                        document.getElementById('playerYT').style.display = 'block';


                        if (links === null) {
                            document.getElementById('streamPopupStart').querySelector('div').innerHTML = '<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 320.001 320.001" style="enable-background:new 0 0 320.001 320.001;" xml:space="preserve">' +
                                '<path d="M295.84,146.049l-256-144c-4.96-2.784-11.008-2.72-15.904,0.128C19.008,5.057,16,10.305,16,16.001v288 c0,5.696,3.008,10.944,7.936,13.824c2.496,1.44,5.28,2.176,8.064,2.176c2.688,0,5.408-0.672,7.84-2.048l256-144 c5.024-2.848,8.16-8.16,8.16-13.952S300.864,148.897,295.84,146.049z"/>' +
                                '</svg>';
                        } else {
                            document.getElementById('streamPopupStart').querySelector('div').innerHTML = '<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 320.001 320.001" style="enable-background:new 0 0 320.001 320.001;" xml:space="preserve">' +
                                '<path d="M295.84,146.049l-256-144c-4.96-2.784-11.008-2.72-15.904,0.128C19.008,5.057,16,10.305,16,16.001v288 c0,5.696,3.008,10.944,7.936,13.824c2.496,1.44,5.28,2.176,8.064,2.176c2.688,0,5.408-0.672,7.84-2.048l256-144 c5.024-2.848,8.16-8.16,8.16-13.952S300.864,148.897,295.84,146.049z"/>' +
                                '</svg>';

                        }
                        event.target.setVolume(50);

                        document.querySelector('#closeFrame').addEventListener('click', function () {
                            const now = new Date();
                            now.setMinutes(now.getMinutes() + 10);

                            document.cookie = 'hide_popup_video=true;expires=' + now.toUTCString() + ';path=/';
                        })
                    },
                }
            });
        }
    }
    if(videoTypeID !== '1'){
        document.getElementById('closeFrame').addEventListener('click', (e) => {
            playerYT.stopVideo();
            document.getElementById('stream').style.display = 'none';
            document.getElementById('playerYT').style.display = 'none';
        })
        document.getElementById('streamPopupSound').querySelector('span').addEventListener('click', (e) => {
            if (mute) {
                mute = false;
                playerYT.unMute();
                document.getElementById('playerButtonUnMuted').style.display = 'flex';
                document.getElementById('playerButtonMuted').style.display = 'none';
            } else {
                mute = true;
                playerYT.mute();
                document.getElementById('playerButtonUnMuted').style.display = 'none';
                document.getElementById('playerButtonMuted').style.display = 'flex';
            }
            hidePlayerButtons();
        })
        document.getElementById('streamPopupStart').querySelector('span').addEventListener('click', (e) => {
            if (play) {
                playerYT.pauseVideo();
                play = false;
                document.getElementById('playerButtonPlay').style.display = 'flex';
                document.getElementById('playerButtonPause').style.display = 'none';
            } else {
                playerYT.playVideo();
                play = true;
                document.getElementById('playerButtonPlay').style.display = 'none';
                document.getElementById('playerButtonPause').style.display = 'flex';
            }
            hidePlayerButtons();
        })
        document.getElementById('streamPopupLink').querySelector('span').addEventListener('click', (e) => {
            if (window.innerWidth > 600) {
                if (links !== null) {
                  window.open('https://www.youtube.com/watch?v=' + links + '&has_verified=1', "_blank");
                }
            } else {
                if (!full) {
                    full = true;
                    document.getElementById('stream').classList.add('full');
                } else {
                    full = false;
                    document.getElementById('stream').classList.remove('full');
                }
            }
            hidePlayerButtons();
        });
    }
    document.getElementById('stream').addEventListener('click', (e) => {
        if (window.innerWidth <= 600 && full) {
            document.getElementById('streamPopupSound').style.display = 'block';
            document.getElementById('streamPopupStart').style.display = 'block';
            document.getElementById('streamPopupLink').style.display = 'block';
        }
    });
    document.addEventListener('DOMContentLoaded', function () {
        let isFormOrLink = true;

        $('a').on('click', function () {
            isFormOrLink = true;
        });
        $('form').on('submit', function () {
            isFormOrLink = true;
        });

        window.addEventListener('beforeunload', function () {
            if (!isFormOrLink) {
                const now = new Date();
                now.setMinutes(now.getMinutes() - 1);

                document.cookie = 'hide_popup_video=true;expires=' + now.toUTCString() + ';path=/';
            }
        })
    })
</script>