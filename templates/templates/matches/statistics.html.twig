<div class="component statistics">
    <div class="header">
        <div class="round">
            <div><img src="/images/lamp.svg" alt="lamp.svg"/></div>
        </div>
        <div class="title">
            Статистика
        </div>
    </div>
    <div class="grid-select">
        <div class="lft statistics-map-selector">
            <span class="active" data-attr="all">Все карты</span>
            {% for matchstatistics in match.matchstatistics %}
                <span data-attr="{{ matchstatistics.map.code }}">{{ matchstatistics.map.name }}</span>
            {% endfor %}
        </div>
        <div class="rgt">
            <span class="active">Обе стороны</span>
            <span>T</span>
            <span>CT</span>
        </div>
    </div>
    <div class="grid-block statistics-maps">
        <div class="grid-header">
            <div class="r">
                {% if match.team1 is not null and match.team1.logo is not null%}
                    <img src="/uploads/images/{{match.team1.logo}}" class="logo" alt="ua.svg" />{{ match.team1.name }}
                {% else %}
                    <img src="/images/noLogo.png" alt="ua.svg" />{{ match.team1 ? match.team1.name: '???' }}
                {% endif %}
            </div>
            <div class="r">K-D</div>
            <div class="r">+/-</div>
            <div class="r">ADR</div>
            <div class="r">KAST</div>
            <div class="r">Rating</div>
        </div>
        {% for playerStatistic in playerStatisticsTeam1 %}
            <div class="grid-row">
                <div class="r">
                    <span>{{ playerStatistic.player.person.nick }}</span>
                    <img src="/uploads/images/{{ playerStatistic.player.person.photo }}" class="logo"
                         alt="{{ playerStatistic.player.person.nick }}"/>
                    <div class="grid-subrow">
                        <div>K-D</div>
                        <div>+/-</div>
                        <div>ADR</div>
                        <div>KAST</div>
                        <div>Rating</div>
                    </div>
                    <div class="grid-subrow">
                        {% set plusMinus = playerStatistic.killvalue|number_format - playerStatistic.deathvalue %}
                        {% set kpr = playerStatistic.killvalue|number_format / match.getRounds(playerStatistic.map.id) %}
                        <div class="player-{{ playerStatistic.player.id }}-kpr">{{ kpr ? kpr|number_format(2) : '???' }}</div>
                        <div class="player-{{ playerStatistic.player.id }}-killdeath">{{ playerStatistic.killvalue ? playerStatistic.killvalue|number_format : '???' }}
                            -{{ playerStatistic.deathvalue ? playerStatistic.deathvalue : '???' }}</div>
                        <div class="player-{{ playerStatistic.player.id }}-killdeath">{% if plusMinus > 0 %}+{% endif %}{{ plusMinus }}</div>
                        <div class="player-{{ playerStatistic.player.id }}-adr">{{ playerStatistic.adr ? playerStatistic.adr : '???' }}</div>
                        <div class="player-{{ playerStatistic.player.id }}-kast">{{ playerStatistic.kast ? playerStatistic.kast : '???' }}</div>
                        <div class="player-{{ playerStatistic.player.id }}-rating">{{ playerStatistic.rating }}</div>
                    </div>
                </div>
                <div class="r">{{ playerStatistic.killvalue|number_format }}-{{ playerStatistic.deathvalue }}</div>
                <div class="r">{% if plusMinus > 0 %}+{% endif %}{{ plusMinus }}</div>
                <div class="r">{{ playerStatistic.adr }}</div>
                <div class="r">{{ playerStatistic.kast }}</div>
                <div class="r">{{ playerStatistic.rating }}</div>
            </div>
        {% endfor %}
    </div>
    <div class="grid-block">
        <div class="grid-header">
            <div class="r">
                {% if match.team2 is not null and match.team2.logo is not null%}
                    <img src="/uploads/images/{{match.team2.logo}}" class="logo" alt="ua.svg" />{{ match.team2.name }}
                {% else %}
                    <img src="/images/noLogo.png" alt="ua.svg" />{{ match.team2 ? match.team2.name: '???' }}
                {% endif %}
            </div>
            <div class="r">K-D</div>
            <div class="r">+/-</div>
            <div class="r">ADR</div>
            <div class="r">KAST</div>
            <div class="r">Rating</div>
        </div>
        {% for playerStatistic in playerStatisticsTeam2 %}
            <div class="grid-row">
                <div class="r">
                    <span>{{ playerStatistic.player.person.nick }}</span>
                    <img src="/uploads/images/{{ playerStatistic.player.person.photo }}" class="logo"
                         alt="{{ playerStatistic.player.person.nick }}"/>
                    <div class="grid-subrow">
                        <div>K-D</div>
                        <div>+/-</div>
                        <div>ADR</div>
                        <div>KAST</div>
                        <div>Rating</div>
                    </div>
                    <div class="grid-subrow">
                        {% set plusMinus = playerStatistic.killvalue|number_format - playerStatistic.deathvalue %}
                        {% set kpr = playerStatistic.killvalue|number_format / match.getRounds(playerStatistic.map.id) %}
                        <div class="player-{{ playerStatistic.player.id }}-kpr">{{ kpr|number_format(2) }}</div>
                        <div class="player-{{ playerStatistic.player.id }}-killdeath">{{ playerStatistic.killvalue|number_format }}
                            -{{ playerStatistic.deathvalue }}</div>
                        <div class="player-{{ playerStatistic.player.id }}-killdeath">{% if plusMinus > 0 %}+{% endif %}{{ plusMinus }}</div>
                        <div class="player-{{ playerStatistic.player.id }}-adr">{{ playerStatistic.adr }}</div>
                        <div class="player-{{ playerStatistic.player.id }}-kast">{{ playerStatistic.kast }}</div>
                        <div class="player-{{ playerStatistic.player.id }}-rating">{{ playerStatistic.rating }}</div>
                    </div>
                </div>
                <div class="r">{{ playerStatistic.killvalue|number_format }}-{{ playerStatistic.deathvalue }}</div>
                <div class="r">{% if plusMinus > 0 %}+{% endif %}{{ plusMinus }}</div>
                <div class="r">{{ playerStatistic.adr }}</div>
                <div class="r">{{ playerStatistic.kast }}</div>
                <div class="r">{{ playerStatistic.rating }}</div>
            </div>
        {% endfor %}
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script>
    $('.statistics-map-selector>span').on('click', function () {
        const type = $(this).data('attr');
        const rowSelector = $('.statistics-maps>.grid-row');

        $('.statistics-map-selector>span').forEach((item) => {
            $(item).removeClass('active');
        })
        $(this).addClass('active');
        if (type === 'all') {
            rowSelector.show();
        } else {
            rowSelector.hide();
            rowSelector.forEach((item) => {
                if ($(item).data('map') === type) {

                }
            })
        }
    })
</script>
