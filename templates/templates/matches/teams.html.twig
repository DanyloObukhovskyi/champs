<div class="component teams-matches">
    <div class="header">
        <div class="round">
            <div><img src="/images/lamp.svg" alt="lamp.svg"/></div>
        </div>
        <div class="title">
            Команды
        </div>
    </div>
    <div class="grid-block">
        <div class="title">
            <div class="lft">
                {% if match.team1 is not null and match.team1.logo is not null%}
                    <img src="/uploads/images/{{match.team1.logo}}" class="logo" alt="ua.svg" />{{ match.team1.name }}
                {% else %}
                    <img src="/images/noLogo.png" />{{ match.team1 ? match.team1.name: '???' }}
                {% endif %}
            </div>
        </div>
        {% if match.team1 is not null%}
            <div class="players l-team">
                {% set first = true %}
                {% set counter = 0 %}
                {% for player in match.team1.players %}
                    {% set counter = counter + 1 %}
                    {% if(counter < 6) %}
                    <div class="player {% if first %}active{% endif %}">
                        <div class="logo">
                            {% if player.person.photo is not null%}
                                <img data-team="l" data-player="{{ player.id }}" src="/uploads/images/{{ player.person.photo }}"
                                    class="logo" alt="PlayerA1" attr-row-id="{{player.person.id}}" attr-row-field="photo" attr-row-table="person" onclick="EditData(this,'img2')" />
                            {% else %}
                                <img data-team="l" data-player="{{ player.id}}" src="/images/blankplayer.svg"
                                     class="logo w-100 h-100" alt="PlayerA1" attr-row-id="{{player.person.id}}" attr-row-field="photo" attr-row-table="person" onclick="EditData(this,'img2')" />
                            {% endif %}
                        </div>
                        <div class="name" attr-row-id="{{player.person.id}}" attr-row-field="nick" attr-row-table="person" onclick="EditData(this)" >{{ player.person.nick }}</div>
                    </div>
                    {% set first = false %}
                    {% endif %}
                {% endfor %}
            </div>
        {% endif %}
    </div>

    <div class="grid-result player-srav">
        <div class="l-block">
            {% if match.team1 is not null and match.team1.logo is not null%}
                {% set firstPlayerTeam1 = match.team1.players|first %}
                <img src="/uploads/images/{{ match.team1.logo }}" class="logo_team" alt="Rectangle7"/>
                <img src="/uploads/images/{{ firstPlayerTeam1.person.photo }}" class="logo"
                     alt="{{ firstPlayerTeam1.person.nick }}"/>
            {% endif %}
        </div>
        <div class="c-block">
            <div class="row-c">
                <div class="l change change-rating change-rating-l">???</div>
                <div class="c">RATING</div>
                <div class="r change change-rating change-rating-r">???</div>
            </div>
            <div class="row-c">
                <div class="l change change-kpr change-kpr-l">???</div>
                <div class="c">KILLS PER ROUND</div>
                <div class="r change change-kpr change-kpr-r">???</div>
            </div>
            <div class="row-c">
                <div class="l change change-kast change-kast-l">???</div>
                <div class="c">KAST</div>
                <div class="r change change-kast change-kast-r">???</div>
            </div>
            <div class="row-c" style="display: none">
                <div class="l change change-impact change-impact-l">???</div>
                <div class="c">IMPACT</div>
                <div class="r change change-impact change-impact-r">???</div>
            </div>
            <div class="row-c">
                <div class="l change change-adr change-adr-l">???</div>
                <div class="c">average damage</div>
                <div class="r change change-adr change-adr-r">???</div>
            </div>
        </div>
        <div class="r-block">
            {% if match.team2 is not null and match.team2.logo is not null%}
                {% set firstPlayerTeam2 = match.team2.players|first %}
                <img src="/uploads/images/{{ match.team2.logo }}" class="logo_team" alt="Rectangle6"/>
                <img src="/uploads/images/{{ firstPlayerTeam2.person.photo }}" class="logo"
                     alt="{{ firstPlayerTeam2.person.nick }}"/>
            {% endif %}
        </div>
    </div>

    <div class="grid-block">
        <div class="title">
            <div class="lft">
                {% if match.team2 is not null and match.team2.logo is not null%}
                    <img src="/uploads/images/{{match.team2.logo}}" class="logo" alt="ua.svg" />{{ match.team2.name }}
                {% else %}
                    <img src="/images/noLogo.png" class="logo" alt="ua.svg" />{{ match.team2 ? match.team2.name: '???' }}
                {% endif %}
            </div>
        </div>
        {% if match.team2 is not null %}
            <div class="players r-team">
                {% set first = true %}
                {% set counter = 0 %}
                {% for player in match.team2.players %}
                    {% set counter = counter + 1 %}
                    {% if(counter < 6) %}
                        <div class="player {% if first %}active{% endif %}">
                            <div class="logo">
                                {% if player.person.photo is not null%}
                                    <img data-team="r" data-player="{{ player.id }}" src="/uploads/images/{{ player.person.photo }}"
                                         class="logo" alt="PlayerA1" attr-row-id="{{player.person.id}}" attr-row-field="photo" attr-row-table="person" onclick="EditData(this,'img2')" />
                                {% else %}
                                    <img data-team="r" data-player="{{player.id}}" src="/images/blankplayer.svg"
                                         class="logo" alt="PlayerA1"  attr-row-id="{{player.person.id}}" attr-row-field="photo" attr-row-table="person" onclick="EditData(this,'img2')" />
                                {% endif %}
                            </div>
                            <div class="name" attr-row-id="{{player.person.id}}" attr-row-field="nick" attr-row-table="person" onclick="EditData(this)">{{ player.person.nick }}</div>
                        </div>
                        {% set first = false %}
                    {% endif %}
                {% endfor %}
            </div>
        {% endif %}
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script>
    $('.players>.player').on('click', function () {
        const img = $(this).find('.logo>img');
        $('.players.' + img.data('team') + '-team>.player').removeClass('active');
        $(this).addClass('active');
        const numSel = '.change.' + img.data('team');

        let playerId = img.data('player');

        let row_id = $('.player-' + playerId + '-rating').attr('attr-row-id');

        $(numSel + '.change-rating-' + img.data('team')).html($('.player-' + playerId + '-rating').html());
        $(numSel + '.change-kpr-' + img.data('team')).html($('.player-' + playerId + '-kpr').html());
        $(numSel + '.change-kast-' + img.data('team')).html($('.player-' + playerId + '-kast').html());
        $(numSel + '.change-adr-' + img.data('team')).html($('.player-' + playerId + '-adr').html());

        //
        let u_rating = $('.player-' + playerId + '-rating').html();
        u_rating = u_rating.replace(/\-/g, "");
        $(numSel + '.change-rating-' + img.data('team')).attr("attr-row-data", u_rating);
        $(numSel + '.change-rating-' + img.data('team')).attr("attr-row-id", row_id);
        $(numSel + '.change-rating-' + img.data('team')).attr("attr-row-field", "rating");
        $(numSel + '.change-rating-' + img.data('team')).attr("attr-row-table", "player_statistics");
        $(numSel + '.change-rating-' + img.data('team')).attr("onclick", "EditData(this, 'player_d')");
        //
        let u_kpr = $('.player-' + playerId + '-kpr').html();
        u_kpr = u_kpr.replace(/\-/g, "");
        $(numSel + '.change-kpr-' + img.data('team')).attr("attr-row-data", u_kpr);
        $(numSel + '.change-kpr-' + img.data('team')).attr("attr-row-id", row_id);
        $(numSel + '.change-kpr-' + img.data('team')).attr("attr-row-field", "plus_minus");
        $(numSel + '.change-kpr-' + img.data('team')).attr("attr-row-table", "player_statistics");
        $(numSel + '.change-kpr-' + img.data('team')).attr("onclick", "EditData(this, 'player_d')");
        //
        let u_kast = $('.player-' + playerId + '-kast').html();
        u_kast = u_kast.replace(/\-/g, "");
        $(numSel + '.change-kast-' + img.data('team')).attr("attr-row-data", u_kast);
        $(numSel + '.change-kast-' + img.data('team')).attr("attr-row-id", row_id);
        $(numSel + '.change-kast-' + img.data('team')).attr("attr-row-field", "kast");
        $(numSel + '.change-kast-' + img.data('team')).attr("attr-row-table", "player_statistics");
        $(numSel + '.change-kast-' + img.data('team')).attr("onclick", "EditData(this, 'player_d')");
        //
        let u_adr = $('.player-' + playerId + '-adr').html();
        u_adr = u_adr.replace(/\-/g, "");
        $(numSel + '.change-adr-' + img.data('team')).attr("attr-row-data", u_adr);
        $(numSel + '.change-adr-' + img.data('team')).attr("attr-row-id", row_id);
        $(numSel + '.change-adr-' + img.data('team')).attr("attr-row-field", "adr");
        $(numSel + '.change-adr-' + img.data('team')).attr("attr-row-table", "player_statistics");
        $(numSel + '.change-adr-' + img.data('team')).attr("onclick", "EditData(this, 'player_d')");

        letOrange('.change-rating');
        letOrange('.change-kpr');
        letOrange('.change-kast');
        letOrange('.change-adr');

        $('.player-srav>.' + img.data('team') + '-block>.logo').attr('src', img.attr('src'));
    })

    function getRandomArbitrary(min, max) {
        return Math.floor((Math.random() * (max - min) + min) * 100) / 100;
    }

    function letOrange(sel) {
        let max = -1;
        $(sel).each(function (index, item) {
            if (max < parseFloat($(item).html())) {
                max = parseFloat($(item).html());
            }
        })

        $(sel).each(function (index, item) {
            if (max === parseFloat($(item).html())) {
                $(item).addClass('orange');
            } else {
                $(item).removeClass('orange');
            }
        })

    }

    $('.players>.player.active').click();
</script>
